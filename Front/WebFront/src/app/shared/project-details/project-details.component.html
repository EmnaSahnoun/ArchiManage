<div class="project-details-container" *ngIf="projet"> <!-- Add *ngIf here -->
  <app-header [title]="projet?.name"></app-header> <!-- Use projet?.name -->


  <!-- Navigation entre les onglets -->
  <div class="tabs">
    <button (click)="changeTab('details')" [class.active]="selectedTab === 'details'">Détails du projet</button>
    <button (click)="changeTab('phases')" [class.active]="selectedTab === 'phases'">Phases</button>
  </div>

  <!-- Contenu des onglets -->
  <div *ngIf="selectedTab === 'details'" class="tab-content details-content">
    <div class="left-panel">
      <div class="card">
        <h2>Détails du projet</h2>
        <div *ngIf="!isEditing">
          <p><strong>Nom :</strong> {{ projet?.name }}</p>
          <p><strong>Description :</strong> {{ projet?.description || 'Pas de description' }}</p>
          <p><strong>Date de création :</strong> {{ projet.createdAt | date:'dd/MM/yyyy à HH:mm' }}</p>
          <button class="edit-btn" (click)="startEdit()">Modifier</button>
        </div>
        <!-- Mode édition -->
        <div *ngIf="isEditing">
          <div class="form-group mb-3">
            <label for="projectName"><strong>Nom :</strong></label>
            <input type="text" id="projectName" class="form-control" [(ngModel)]="editedProjectData.name">
          </div>
          <div class="form-group mb-3">
            <label for="projectDescription"><strong>Description :</strong></label>
            <textarea id="projectDescription" class="form-control" rows="3" [(ngModel)]="editedProjectData.description"></textarea>
          </div>
          <p><strong>Date de création :</strong> {{ projet.createdAt | date:'dd/MM/yyyy à HH:mm' }}</p> <!-- Date non modifiable -->
          <button class="save-btn me-2" (click)="saveEdit()" [disabled]="isLoading">Enregistrer</button>
          <button class="cancel-btn" (click)="cancelEdit()" [disabled]="isLoading">Annuler</button>
        </div>
      </div>
    </div>

    <div class="right-panel">
      <div class="card">
        <h2>Statistiques</h2>
        <div class="progress-container">
          <svg width="100" height="100">
            <circle cx="50" cy="50" r="40" stroke="#ddd" stroke-width="8" fill="none"></circle>
            <circle cx="50" cy="50" r="40" stroke="#41B3A3" stroke-width="8" fill="none"
                    stroke-dasharray="251.2" attr.stroke-dashoffset="{{ progressOffset }}"></circle>
          </svg>
          <div class="progress-text">{{ projet?.progress }}%</div> <!-- Use projet?.progress -->
  
        </div>
      </div>

      <div class="card">
        <h2>Membres du projet</h2>
        <ul>
          <li *ngFor="let member of members">{{ member.username }}  - {{ member.role }}</li>
        </ul>
      </div>
    </div>
  </div>

  <div *ngIf="selectedTab === 'phases'" class="tab-content">
    <div class="header">
      <h2>Phases</h2>
      <button mat-button class="add-phase" (click)="addPhase()">
        <i class="bi bi-plus"></i> Ajouter une phase
      </button>
    </div>
  
    <!-- Affichage des phases dans un tableau -->
    <div *ngIf="phases.length > 0" class="phases-table">
      <table>
        <thead>
          <tr>
            <th>Nom de la Phase</th>
            <th>Description</th>
            <th>Date (Début - Fin)</th>
            <th>Nombre de Tâches</th>
            <th>Membres ayant accès</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let phase of phases"(click)="openTasks(phase)" >
            <td  >{{ phase.name }}</td>
            <td >{{ phase.description || 'Pas de description' }}</td>
            <td >{{ phase.startDate | date:'dd/MM/yyyy'}} - {{ phase.endDate | date:'dd/MM/yyyy' }}</td>
            <td >{{ phase.taskIds?.length ?? 0 }}</td>

            
            <td>
              <div class="members-container">
                <div class="members">
                  <button class="members-action-button" (click)="openPhaseAccesssModal(phase)" matTooltip="Voir/Gérer les membres">
                    <mat-icon>group</mat-icon>
                  </button>
                  
                </div>
            
                <button (click)="openMemberModal(phase)" class="add-member-btn">
                  <i class="bi bi-plus-circle icon"></i>
                </button>
              </div>
            </td>
            
            
        
            <td>
              <button mat-icon-button (click)="editPhase(phase)">
                <i class="bi bi-pencil icon" ></i>
              </button>
              <button mat-icon-button (click)="deletePhase(phase)">
                <i class="bi bi-trash"></i>
              </button>
            </td>
          </tr>
        </tbody>
        
      </table>
    </div>
  
    <div *ngIf="phases.length === 0">
      <p>Aucune phase disponible pour ce projet.</p>
    </div>
  </div>
  
  
</div>
