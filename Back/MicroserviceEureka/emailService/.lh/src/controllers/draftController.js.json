{
    "sourceFile": "src/controllers/draftController.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 19,
            "patches": [
                {
                    "date": 1748519278512,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1748519290633,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -61,7 +61,7 @@\n   }\r\n };\r\n \r\n module.exports = {\r\n-  getDraftsHandler,\r\n+  createDraft,\r\n   deleteDraftHandler,\r\n };\r\n"
                },
                {
                    "date": 1748519300413,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -62,6 +62,8 @@\n };\r\n \r\n module.exports = {\r\n   createDraft,\r\n-  deleteDraftHandler,\r\n+  getDraftsList,\r\n+  deleteDraft,\r\n+  \r\n };\r\n"
                },
                {
                    "date": 1748534660822,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,6 +1,7 @@\n const gmailService = require(\"../services/gmailService\");\r\n \r\n+\r\n // Draft management\r\n const createDraft = async (req, res) => {\r\n   try {\r\n     const { accessToken, draftData } = req.body;\r\n@@ -64,6 +65,6 @@\n module.exports = {\r\n   createDraft,\r\n   getDraftsList,\r\n   deleteDraft,\r\n-  \r\n+  sendDraft\r\n };\r\n"
                },
                {
                    "date": 1748534746538,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,11 +1,15 @@\n const gmailService = require(\"../services/gmailService\");\r\n \r\n+const getUserId = (req) => {\r\n+  return req.user?.id || req.user?.email || 'default-user';\r\n+};\r\n \r\n // Draft management\r\n const createDraft = async (req, res) => {\r\n   try {\r\n     const { accessToken, draftData } = req.body;\r\n+    \r\n     const draft = await gmailService.createDraft(accessToken, draftData);\r\n     res.json({ success: true, data: draft });\r\n   } catch (error) {\r\n     res.status(500).json({\r\n"
                },
                {
                    "date": 1748534755385,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,10 +7,10 @@\n // Draft management\r\n const createDraft = async (req, res) => {\r\n   try {\r\n     const { accessToken, draftData } = req.body;\r\n-    \r\n-    const draft = await gmailService.createDraft(accessToken, draftData);\r\n+    const userId = getUserId(req);\r\n+    const draft = await gmailService.createDraft(accessToken, draftData,userId);\r\n     res.json({ success: true, data: draft });\r\n   } catch (error) {\r\n     res.status(500).json({\r\n       success: false,\r\n"
                },
                {
                    "date": 1748534776189,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,8 +22,9 @@\n \r\n const getDraftsList = async (req, res) => {\r\n   try {\r\n     const { accessToken, maxResults } = req.query;\r\n+    const userId = getUserId(req);\r\n     const drafts = await gmailService.getDrafts(accessToken, maxResults);\r\n     res.json({ success: true, data: drafts });\r\n   } catch (error) {\r\n     res.status(500).json({\r\n"
                },
                {
                    "date": 1748534785978,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,9 +23,9 @@\n const getDraftsList = async (req, res) => {\r\n   try {\r\n     const { accessToken, maxResults } = req.query;\r\n     const userId = getUserId(req);\r\n-    const drafts = await gmailService.getDrafts(accessToken, maxResults);\r\n+    const drafts = await gmailService.getDrafts(accessToken, maxResults,user);\r\n     res.json({ success: true, data: drafts });\r\n   } catch (error) {\r\n     res.status(500).json({\r\n       success: false,\r\n"
                },
                {
                    "date": 1748534810195,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,9 +23,9 @@\n const getDraftsList = async (req, res) => {\r\n   try {\r\n     const { accessToken, maxResults } = req.query;\r\n     const userId = getUserId(req);\r\n-    const drafts = await gmailService.getDrafts(accessToken, maxResults,user);\r\n+    const drafts = await gmailService.getDrafts(accessToken, maxResults,userId);\r\n     res.json({ success: true, data: drafts });\r\n   } catch (error) {\r\n     res.status(500).json({\r\n       success: false,\r\n@@ -38,9 +38,9 @@\n const deleteDraft = async (req, res) => {\r\n   try {\r\n     const { accessToken } = req.query;\r\n     const { draftId } = req.params;\r\n-    \r\n+    const userId = getUserId(req);\r\n     await gmailService.deleteDraft(accessToken, draftId);\r\n     res.json({ success: true });\r\n   } catch (error) {\r\n     res.status(500).json({\r\n"
                },
                {
                    "date": 1748534823616,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,75 @@\n+const gmailService = require(\"../services/gmailService\");\r\n+\r\n+const getUserId = (req) => {\r\n+  return req.user?.id || req.user?.email || 'default-user';\r\n+};\r\n+\r\n+// Draft management\r\n+const createDraft = async (req, res) => {\r\n+  try {\r\n+    const { accessToken, draftData } = req.body;\r\n+    const userId = getUserId(req);\r\n+    const draft = await gmailService.createDraft(accessToken, draftData,userId);\r\n+    res.json({ success: true, data: draft });\r\n+  } catch (error) {\r\n+    res.status(500).json({\r\n+      success: false,\r\n+      error: \"Failed to create draft\",\r\n+      details: error.message\r\n+    });\r\n+  }\r\n+};\r\n+\r\n+const getDraftsList = async (req, res) => {\r\n+  try {\r\n+    const { accessToken, maxResults } = req.query;\r\n+    const userId = getUserId(req);\r\n+    const drafts = await gmailService.getDrafts(accessToken, maxResults,userId);\r\n+    res.json({ success: true, data: drafts });\r\n+  } catch (error) {\r\n+    res.status(500).json({\r\n+      success: false,\r\n+      error: \"Failed to get drafts\",\r\n+      details: error.message\r\n+    });\r\n+  }\r\n+};\r\n+\r\n+const deleteDraft = async (req, res) => {\r\n+  try {\r\n+    const { accessToken } = req.query;\r\n+    const { draftId } = req.params;\r\n+    const userId = getUserId(req);\r\n+    await gmailService.deleteDraft(accessToken, draftId,userId);\r\n+    res.json({ success: true });\r\n+  } catch (error) {\r\n+    res.status(500).json({\r\n+      success: false,\r\n+      error: \"Failed to delete draft\",\r\n+      details: error.message\r\n+    });\r\n+  }\r\n+};\r\n+\r\n+const sendDraft = async (req, res) => {\r\n+  try {\r\n+    const { accessToken } = req.query;\r\n+    const { draftId } = req.params;\r\n+    \r\n+    const result = await gmailService.sendDraft(accessToken, draftId);\r\n+    res.json({ success: true, data: result });\r\n+  } catch (error) {\r\n+    res.status(500).json({\r\n+      success: false,\r\n+      error: \"Failed to send draft\",\r\n+      details: error.message\r\n+    });\r\n+  }\r\n+};\r\n+\r\n+module.exports = {\r\n+  createDraft,\r\n+  getDraftsList,\r\n+  deleteDraft,\r\n+  sendDraft\r\n+};\r\n"
                },
                {
                    "date": 1748534842940,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -54,84 +54,9 @@\n const sendDraft = async (req, res) => {\r\n   try {\r\n     const { accessToken } = req.query;\r\n     const { draftId } = req.params;\r\n-    \r\n-    const result = await gmailService.sendDraft(accessToken, draftId);\r\n-    res.json({ success: true, data: result });\r\n-  } catch (error) {\r\n-    res.status(500).json({\r\n-      success: false,\r\n-      error: \"Failed to send draft\",\r\n-      details: error.message\r\n-    });\r\n-  }\r\n-};\r\n-\r\n-module.exports = {\r\n-  createDraft,\r\n-  getDraftsList,\r\n-  deleteDraft,\r\n-  sendDraft\r\n-};\r\n-const gmailService = require(\"../services/gmailService\");\r\n-\r\n-const getUserId = (req) => {\r\n-  return req.user?.id || req.user?.email || 'default-user';\r\n-};\r\n-\r\n-// Draft management\r\n-const createDraft = async (req, res) => {\r\n-  try {\r\n-    const { accessToken, draftData } = req.body;\r\n     const userId = getUserId(req);\r\n-    const draft = await gmailService.createDraft(accessToken, draftData,userId);\r\n-    res.json({ success: true, data: draft });\r\n-  } catch (error) {\r\n-    res.status(500).json({\r\n-      success: false,\r\n-      error: \"Failed to create draft\",\r\n-      details: error.message\r\n-    });\r\n-  }\r\n-};\r\n-\r\n-const getDraftsList = async (req, res) => {\r\n-  try {\r\n-    const { accessToken, maxResults } = req.query;\r\n-    const userId = getUserId(req);\r\n-    const drafts = await gmailService.getDrafts(accessToken, maxResults,userId);\r\n-    res.json({ success: true, data: drafts });\r\n-  } catch (error) {\r\n-    res.status(500).json({\r\n-      success: false,\r\n-      error: \"Failed to get drafts\",\r\n-      details: error.message\r\n-    });\r\n-  }\r\n-};\r\n-\r\n-const deleteDraft = async (req, res) => {\r\n-  try {\r\n-    const { accessToken } = req.query;\r\n-    const { draftId } = req.params;\r\n-    const userId = getUserId(req);\r\n-    await gmailService.deleteDraft(accessToken, draftId);\r\n-    res.json({ success: true });\r\n-  } catch (error) {\r\n-    res.status(500).json({\r\n-      success: false,\r\n-      error: \"Failed to delete draft\",\r\n-      details: error.message\r\n-    });\r\n-  }\r\n-};\r\n-\r\n-const sendDraft = async (req, res) => {\r\n-  try {\r\n-    const { accessToken } = req.query;\r\n-    const { draftId } = req.params;\r\n-    \r\n     const result = await gmailService.sendDraft(accessToken, draftId);\r\n     res.json({ success: true, data: result });\r\n   } catch (error) {\r\n     res.status(500).json({\r\n"
                },
                {
                    "date": 1748535268610,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,8 @@\n const gmailService = require(\"../services/gmailService\");\r\n \r\n const getUserId = (req) => {\r\n-  return req.user?.id || req.user?.email || 'default-user';\r\n+  return req.user?.id || req.user?.email || 'me';\r\n };\r\n \r\n // Draft management\r\n const createDraft = async (req, res) => {\r\n@@ -55,9 +55,9 @@\n   try {\r\n     const { accessToken } = req.query;\r\n     const { draftId } = req.params;\r\n     const userId = getUserId(req);\r\n-    const result = await gmailService.sendDraft(accessToken, draftId);\r\n+    const result = await gmailService.sendDraft(accessToken, draftId,userId);\r\n     res.json({ success: true, data: result });\r\n   } catch (error) {\r\n     res.status(500).json({\r\n       success: false,\r\n"
                },
                {
                    "date": 1748535337808,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,8 @@\n const gmailService = require(\"../services/gmailService\");\r\n \r\n const getUserId = (req) => {\r\n-  return req.user?.id || req.user?.email || 'me';\r\n+  return req.user?.id || req.user?.email || 'default-user';\r\n };\r\n \r\n // Draft management\r\n const createDraft = async (req, res) => {\r\n"
                },
                {
                    "date": 1748537625682,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,10 +1,9 @@\n const gmailService = require(\"../services/gmailService\");\r\n \r\n const getUserId = (req) => {\r\n-  return req.user?.id || req.user?.email || 'default-user';\r\n+  return req.user?.email || req.body.draftData?.from || 'default-user';\r\n };\r\n-\r\n // Draft management\r\n const createDraft = async (req, res) => {\r\n   try {\r\n     const { accessToken, draftData } = req.body;\r\n"
                },
                {
                    "date": 1748538666332,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,9 +6,9 @@\n // Draft management\r\n const createDraft = async (req, res) => {\r\n   try {\r\n     const { accessToken, draftData } = req.body;\r\n-    const userId = getUserId(req);\r\n+    \r\n     const draft = await gmailService.createDraft(accessToken, draftData,userId);\r\n     res.json({ success: true, data: draft });\r\n   } catch (error) {\r\n     res.status(500).json({\r\n"
                },
                {
                    "date": 1748538677185,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,9 +5,9 @@\n };\r\n // Draft management\r\n const createDraft = async (req, res) => {\r\n   try {\r\n-    const { accessToken, draftData } = req.body;\r\n+    const { accessToken, draftData,userId } = req.body;\r\n     \r\n     const draft = await gmailService.createDraft(accessToken, draftData,userId);\r\n     res.json({ success: true, data: draft });\r\n   } catch (error) {\r\n@@ -21,9 +21,9 @@\n \r\n const getDraftsList = async (req, res) => {\r\n   try {\r\n     const { accessToken, maxResults } = req.query;\r\n-    const userId = getUserId(req);\r\n+   \r\n     const drafts = await gmailService.getDrafts(accessToken, maxResults,userId);\r\n     res.json({ success: true, data: drafts });\r\n   } catch (error) {\r\n     res.status(500).json({\r\n"
                },
                {
                    "date": 1748538691569,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -20,9 +20,9 @@\n };\r\n \r\n const getDraftsList = async (req, res) => {\r\n   try {\r\n-    const { accessToken, maxResults } = req.query;\r\n+    const { accessToken, maxResults,userId } = req.query;\r\n    \r\n     const drafts = await gmailService.getDrafts(accessToken, maxResults,userId);\r\n     res.json({ success: true, data: drafts });\r\n   } catch (error) {\r\n@@ -37,9 +37,9 @@\n const deleteDraft = async (req, res) => {\r\n   try {\r\n     const { accessToken } = req.query;\r\n     const { draftId } = req.params;\r\n-    const userId = getUserId(req);\r\n+    \r\n     await gmailService.deleteDraft(accessToken, draftId,userId);\r\n     res.json({ success: true });\r\n   } catch (error) {\r\n     res.status(500).json({\r\n"
                },
                {
                    "date": 1748538699755,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -35,9 +35,9 @@\n };\r\n \r\n const deleteDraft = async (req, res) => {\r\n   try {\r\n-    const { accessToken } = req.query;\r\n+    const { accessToken,userId } = req.query;\r\n     const { draftId } = req.params;\r\n     \r\n     await gmailService.deleteDraft(accessToken, draftId,userId);\r\n     res.json({ success: true });\r\n@@ -53,9 +53,9 @@\n const sendDraft = async (req, res) => {\r\n   try {\r\n     const { accessToken } = req.query;\r\n     const { draftId } = req.params;\r\n-    const userId = getUserId(req);\r\n+\r\n     const result = await gmailService.sendDraft(accessToken, draftId,userId);\r\n     res.json({ success: true, data: result });\r\n   } catch (error) {\r\n     res.status(500).json({\r\n"
                },
                {
                    "date": 1748538749619,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -53,9 +53,9 @@\n const sendDraft = async (req, res) => {\r\n   try {\r\n     const { accessToken } = req.query;\r\n     const { draftId } = req.params;\r\n-\r\n+ \r\n     const result = await gmailService.sendDraft(accessToken, draftId,userId);\r\n     res.json({ success: true, data: result });\r\n   } catch (error) {\r\n     res.status(500).json({\r\n"
                },
                {
                    "date": 1748538756145,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -51,9 +51,9 @@\n };\r\n \r\n const sendDraft = async (req, res) => {\r\n   try {\r\n-    const { accessToken } = req.query;\r\n+    const { accessToken ,userId} = req.query;\r\n     const { draftId } = req.params;\r\n  \r\n     const result = await gmailService.sendDraft(accessToken, draftId,userId);\r\n     res.json({ success: true, data: result });\r\n"
                }
            ],
            "date": 1748519278512,
            "name": "Commit-0",
            "content": "const gmailService = require(\"../services/gmailService\");\r\n\r\n// Draft management\r\nconst createDraft = async (req, res) => {\r\n  try {\r\n    const { accessToken, draftData } = req.body;\r\n    const draft = await gmailService.createDraft(accessToken, draftData);\r\n    res.json({ success: true, data: draft });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      error: \"Failed to create draft\",\r\n      details: error.message\r\n    });\r\n  }\r\n};\r\n\r\nconst getDraftsList = async (req, res) => {\r\n  try {\r\n    const { accessToken, maxResults } = req.query;\r\n    const drafts = await gmailService.getDrafts(accessToken, maxResults);\r\n    res.json({ success: true, data: drafts });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      error: \"Failed to get drafts\",\r\n      details: error.message\r\n    });\r\n  }\r\n};\r\n\r\nconst deleteDraft = async (req, res) => {\r\n  try {\r\n    const { accessToken } = req.query;\r\n    const { draftId } = req.params;\r\n    \r\n    await gmailService.deleteDraft(accessToken, draftId);\r\n    res.json({ success: true });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      error: \"Failed to delete draft\",\r\n      details: error.message\r\n    });\r\n  }\r\n};\r\n\r\nconst sendDraft = async (req, res) => {\r\n  try {\r\n    const { accessToken } = req.query;\r\n    const { draftId } = req.params;\r\n    \r\n    const result = await gmailService.sendDraft(accessToken, draftId);\r\n    res.json({ success: true, data: result });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      error: \"Failed to send draft\",\r\n      details: error.message\r\n    });\r\n  }\r\n};\r\n\r\nmodule.exports = {\r\n  getDraftsHandler,\r\n  deleteDraftHandler,\r\n};\r\n"
        }
    ]
}